<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Playground de Curvas Bézier - Teach Laoz</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #f0f2f5;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px;
        color: #333;
      }

      .container {
        background: white;
        padding: 20px;
        border-radius: 12px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        max-width: 800px;
        width: 100%;
      }

      h1 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 20px;
      }

      .controls {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-bottom: 20px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 8px;
      }

      button {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s;
      }

      button.active {
        background: #3498db;
        color: white;
        box-shadow: 0 2px 4px rgba(52, 152, 219, 0.3);
      }

      button:not(.active) {
        background: white;
        color: #666;
        border: 1px solid #ddd;
      }

      .canvas-container {
        position: relative;
        background: #fff;
        border: 2px solid #e0e0e0;
        border-radius: 8px;
        cursor: crosshair;
        margin: 0 auto;
        background-image: radial-gradient(#e0e0e0 1px, transparent 1px);
        background-size: 20px 20px;
      }

      #code-display {
        margin-top: 20px;
        padding: 15px;
        background: #282c34;
        color: #abb2bf;
        border-radius: 6px;
        font-family: "Fira Code", monospace;
        font-size: 14px;
        overflow-x: auto;
      }

      .highlight {
        color: #e06c75;
      }
      .number {
        color: #d19a66;
      }
      .attr {
        color: #98c379;
      }

      /* Estilos SVG interactivos */
      .handle {
        cursor: grab;
        transition: r 0.1s;
      }
      .handle:hover {
        r: 8;
      }
      .handle:active {
        cursor: grabbing;
        fill: #2ecc71;
      }

      .guide-line {
        stroke: #95a5a6;
        stroke-width: 1;
        stroke-dasharray: 4;
      }

      .main-curve {
        fill: none;
        stroke: #3498db;
        stroke-width: 4;
        stroke-linecap: round;
      }

      text {
        user-select: none;
        pointer-events: none;
        font-size: 12px;
        fill: #666;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Playground de Curvas Bézier</h1>

      <div class="controls">
        <button
          id="btn-quadratic"
          class="active"
          onclick="setMode('quadratic')"
        >
          Cuadrática (Q)
        </button>
        <button id="btn-cubic" onclick="setMode('cubic')">Cúbica (C)</button>
      </div>

      <div class="canvas-container">
        <svg id="svg-canvas" width="600" height="400" viewBox="0 0 600 400">
          <!-- Guías -->
          <path id="guide-lines" class="guide-line" d="" />

          <!-- Curva Principal -->
          <path id="main-path" class="main-curve" d="" />

          <!-- Puntos de Control y Etiquetas -->
          <g id="points-group"></g>
        </svg>
      </div>

      <div id="code-display">
        &lt;path d="<span id="path-code"></span>" /&gt;
      </div>
    </div>

    <script>
      // Configuración Inicial
      const svg = document.getElementById("svg-canvas");
      const pointsGroup = document.getElementById("points-group");
      const guidePath = document.getElementById("guide-lines");
      const mainPath = document.getElementById("main-path");
      const codeSpan = document.getElementById("path-code");

      let mode = "quadratic"; // 'quadratic' | 'cubic'
      let selectedPoint = null;

      // Estado de los puntos
      let points = {
        p0: { x: 50, y: 350, label: "Inicio (M)" },
        p1: { x: 300, y: 50, label: "Control 1" },
        p2: { x: 450, y: 50, label: "Control 2" }, // Solo para cubic
        p3: { x: 550, y: 350, label: "Fin" },
      };

      function setMode(newMode) {
        mode = newMode;
        document.getElementById("btn-quadratic").className =
          mode === "quadratic" ? "active" : "";
        document.getElementById("btn-cubic").className =
          mode === "cubic" ? "active" : "";
        render();
      }

      function createHandle(id, x, y, color) {
        const group = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "g"
        );

        const circle = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "circle"
        );
        circle.setAttribute("cx", x);
        circle.setAttribute("cy", y);
        circle.setAttribute("r", 6);
        circle.setAttribute("fill", color);
        circle.setAttribute("stroke", "white");
        circle.setAttribute("stroke-width", 2);
        circle.classList.add("handle");
        circle.dataset.id = id;

        // Eventos de arrastre
        circle.addEventListener("mousedown", startDrag);

        // Etiqueta
        const text = document.createElementNS(
          "http://www.w3.org/2000/svg",
          "text"
        );
        text.setAttribute("x", x);
        text.setAttribute("y", y - 15);
        text.setAttribute("text-anchor", "middle");
        text.textContent = points[id].label;

        group.appendChild(text);
        group.appendChild(circle);
        return group;
      }

      function render() {
        pointsGroup.innerHTML = "";

        // Dibujar handles
        pointsGroup.appendChild(
          createHandle("p0", points.p0.x, points.p0.y, "#e74c3c")
        );
        pointsGroup.appendChild(
          createHandle("p1", points.p1.x, points.p1.y, "#f1c40f")
        );
        pointsGroup.appendChild(
          createHandle("p3", points.p3.x, points.p3.y, "#e74c3c")
        );

        if (mode === "cubic") {
          pointsGroup.appendChild(
            createHandle("p2", points.p2.x, points.p2.y, "#f1c40f")
          );
        }

        // Generar Path y Guías
        let d = "";
        let guideD = "";

        if (mode === "quadratic") {
          d = `M ${points.p0.x} ${points.p0.y} Q ${points.p1.x} ${points.p1.y} ${points.p3.x} ${points.p3.y}`;
          guideD = `M ${points.p0.x} ${points.p0.y} L ${points.p1.x} ${points.p1.y} L ${points.p3.x} ${points.p3.y}`;
        } else {
          d = `M ${points.p0.x} ${points.p0.y} C ${points.p1.x} ${points.p1.y} ${points.p2.x} ${points.p2.y} ${points.p3.x} ${points.p3.y}`;
          guideD = `M ${points.p0.x} ${points.p0.y} L ${points.p1.x} ${points.p1.y} M ${points.p2.x} ${points.p2.y} L ${points.p3.x} ${points.p3.y}`;
        }

        mainPath.setAttribute("d", d);
        guidePath.setAttribute("d", guideD);

        // Actualizar código visual
        codeSpan.innerHTML = d
          .replace(/([MQLC])/g, '<span class="highlight">$1</span>')
          .replace(/(\d+)/g, '<span class="number">$1</span>');
      }

      // Lógica de Arrastre
      function startDrag(e) {
        selectedPoint = e.target.dataset.id;
      }

      function drag(e) {
        if (!selectedPoint) return;

        const rect = svg.getBoundingClientRect();
        const x = Math.round(e.clientX - rect.left);
        const y = Math.round(e.clientY - rect.top);

        // Limitar al canvas
        points[selectedPoint].x = Math.max(0, Math.min(600, x));
        points[selectedPoint].y = Math.max(0, Math.min(400, y));

        render();
      }

      function endDrag() {
        selectedPoint = null;
      }

      document.addEventListener("mousemove", drag);
      document.addEventListener("mouseup", endDrag);

      // Render inicial
      render();
    </script>
  </body>
</html>
